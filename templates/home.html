{% extends "base.html" %}
{% block title %}Trang chÃ­nh - BÃ¡nh MÃ¬ NYNY{% endblock %}

{% block content %}
<div class="container py-5">

  <!-- ğŸ”” Flash messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="alert alert-{{ category }} text-center" role="alert">
          {{ msg }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- ğŸ“Š Tá»•ng quan -->
  <div class="text-center mb-4">
    <p class="text-muted">ğŸ“¦ ÄÆ¡n hÃ ng: <strong>{{ order_count }}</strong> | ğŸ’¬ ÄÃ¡nh giÃ¡: <strong>{{ feedback_count }}</strong></p>
  </div>

  <!-- ğŸ¥– MÃ³n chÃ­nh -->
  <h2 class="section-title mb-4 text-center">ğŸ¥– Thá»±c Ä‘Æ¡n ná»•i báº­t</h2>
  <div class="row g-4">
    {% for item in menu_items %}
    <div class="col-md-4 col-sm-6">
      <div class="card h-100 shadow-sm border-0">
        <img src="{% if item.image %}{{ url_for('static', filename=item.image) }}{% else %}https://source.unsplash.com/400x200/?vietnamese,food{% endif %}"
             class="card-img-top" style="height: 200px; object-fit: cover;" alt="{{ item.name }}">
        <div class="card-body text-center">
          <h5 class="card-title text-uppercase fw-bold">{{ item.name }}</h5>
          <p class="card-text text-danger fs-5">{{ "{:,.0f}".format(item.price | float) }} Ä‘</p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  {% if not current_user.is_authenticated or current_user.role == 'user' %}
    <!-- ğŸ“ Äáº·t hÃ ng -->
    <h2 class="section-title mt-5 text-center" id="order">ğŸ“ Äáº·t hÃ ng nhanh</h2>
    <form method="POST" class="row g-3 bg-white p-4 rounded shadow-sm" id="order-form">
      <input type="hidden" name="form_type" value="order">
      <div class="col-md-6">
        <label class="form-label">Há» vÃ  tÃªn</label>
        <input type="text" class="form-control" name="order_name" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Sá»‘ Ä‘iá»‡n thoáº¡i</label>
        <input type="tel" class="form-control" name="order_phone" required>
      </div>
      <div class="col-12">
        <label class="form-label">Äá»‹a chá»‰ nháº­n hÃ ng</label>
        <textarea class="form-control" name="order_address" rows="2" required></textarea>
      </div>
      <div class="col-12">
        <label class="form-label">Ná»™i dung Ä‘áº·t mÃ³n</label>
        <textarea class="form-control" name="order_content" rows="3" required></textarea>
      </div>
      <div class="col-12 text-center">
        <button type="submit" class="btn btn-custom px-4">ğŸš€ Gá»­i yÃªu cáº§u</button>
      </div>
    </form>

    <!-- ğŸ“£ ÄÃ¡nh giÃ¡ -->
    <h2 class="section-title mt-5 text-center" id="feedback">ğŸ“£ GÃ³p Ã½ & ÄÃ¡nh giÃ¡</h2>
    <form method="POST" class="row g-3 bg-white p-4 rounded shadow-sm" id="feedback-form">
      <input type="hidden" name="form_type" value="feedback">
      <div class="col-md-6">
        <label class="form-label">TÃªn cá»§a báº¡n</label>
        <input type="text" class="form-control" name="feedback_name" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Cháº¥t lÆ°á»£ng dá»‹ch vá»¥</label>
        <select class="form-select" name="feedback_rating" required>
          <option value="">Chá»n sao</option>
          <option>â­</option>
          <option>â­â­</option>
          <option>â­â­â­</option>
          <option>â­â­â­â­</option>
          <option>â­â­â­â­â­</option>
        </select>
      </div>
      <div class="col-12">
        <label class="form-label">GÃ³p Ã½ chi tiáº¿t</label>
        <textarea class="form-control" name="feedback_message" rows="3" required></textarea>
      </div>
      <div class="col-12 text-center">
        <button type="submit" class="btn btn-custom px-4">ğŸ’¬ Gá»­i Ä‘Ã¡nh giÃ¡</button>
      </div>
    </form>
  {% else %}
    <div class="alert alert-warning text-center mt-5">
      ğŸ‘‹ Xin chÃ o <strong>{{ current_user.username }}</strong>, báº¡n Ä‘ang Ä‘Äƒng nháº­p vá»›i quyá»n <strong>{{ current_user.role }}</strong>. TÃ­nh nÄƒng Ä‘áº·t hÃ ng vÃ  Ä‘Ã¡nh giÃ¡ chá»‰ dÃ nh cho khÃ¡ch hoáº·c ngÆ°á»i dÃ¹ng thÃ´ng thÆ°á»ng.
    </div>
  {% endif %}

  <!-- ğŸ—ºï¸ Äá»‹a chá»‰ -->
  <h2 class="section-title mt-5 text-center">ğŸ“ Äá»‹a chá»‰ cá»­a hÃ ng</h2>
  <div class="bg-light rounded shadow-sm p-3">
    <p class="text-center mb-3">
      ğŸ  <strong>Quáº§y Thá»©c Ä‚n Nhanh - Gáº§n UBND xÃ£ LiÃªn SÆ¡n LÄƒk</strong><br>
      ğŸ“ <strong>0935 221 338</strong>
    </p>
    <iframe 
      src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1948.2978207029055!2d108.17397373847122!3d12.40998104696405!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31718ee36c49998d%3A0xc5532e2e53a2ca4!2zUXXhuqd5IFRodeG7kWMgVHJ1bmcgVMOibSBIdXnhu4duIEzhuq9r!5e0!3m2!1svi!2s!4v1752400405467!5m2!1svi!2s" 
      width="100%" height="350" style="border:0; border-radius: 12px;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
    </iframe>
  </div>

</div>
{% endblock %}
